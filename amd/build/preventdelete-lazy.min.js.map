{"version":3,"file":"preventdelete-lazy.min.js","sources":["../src/preventdelete-lazy.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * OER subplugin for loading opencast videos\n *\n * @author     Christian Ortner <christian.ortner@tugraz.at>\n * @copyright  2024 Educational Technologies, Graz, University of Technology\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport * as Templates from \"core/templates\";\nimport * as Str from \"core/str\";\n\n/**\n * Replace the edit and delete icon of already releaased OER videos with an information.\n *\n * @param {{series: id, videos: {videoid, title}}}released\n * @returns {Promise<void>}\n */\nexport const init = async (released) => {\n    const series = released.series;\n    const videos = released.videos;\n    const action = await Str.get_string('haction', 'block_opencast');\n    const visibility = await Str.get_string('hvisibility', 'block_opencast');\n    let foundaction = -1;\n    let foundvisibility = -1;\n\n    for (const key in series) {\n        const table = document.getElementById('opencast-videos-table-' + series[key]);\n        if (!table) {\n            return;\n        }\n        const thead = table.rows[0].cells;\n        for (let i = 0; i < thead.length; i++) {\n            if (thead[i].innerHTML.includes(action + '<div class=\"commands\"></div>')) {\n                foundaction = i;\n            }\n            window.console.log(thead[i].innerHTML);\n            if (thead[i].innerHTML.includes(visibility)) {\n                foundvisibility = i;\n            }\n        }\n        window.console.log(foundvisibility, foundaction);\n        if (foundaction === -1 && foundvisibility === -1) {\n            return; // Nothing to do here.\n        }\n        for (let i = 0; i < table.tBodies[0].rows.length; i++) {\n            const cell = document.getElementById('opencast-videos-table-' + series[key]\n                + '_r' + i + '_c' + foundaction.toString());\n            const visibility = document.getElementById('opencast-videos-table-' + series[key]\n                + '_r' + i + '_c' + foundvisibility.toString());\n            const content = cell.innerHTML;\n            for (const key in videos) {\n                if (content.includes(videos[key].videoid) && foundaction > -1) {\n                    const {html,} = await Templates.renderForPromise('oermod_opencast/info', {});\n                    cell.innerHTML = html;\n                }\n                if (content.includes(videos[key].videoid) && foundvisibility > -1) {\n                    visibility.innerHTML = '-';\n                }\n            }\n        }\n    }\n};"],"names":["_getRequireWildcardCache","e","WeakMap","r","t","_interopRequireWildcard","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","Templates","Str","_exports","init","async","series","released","videos","action","get_string","visibility","foundaction","foundvisibility","key","table","document","getElementById","thead","rows","cells","length","innerHTML","includes","window","console","log","tBodies","cell","toString","content","videoid","html","renderForPromise"],"mappings":"sHAwBgC,SAAAA,yBAAAC,GAAA,GAAA,mBAAAC,QAAA,OAAA,KAAA,IAAAC,EAAAD,IAAAA,QAAAE,EAAAF,IAAAA,eAAAF,yBAAA,SAAAC,GAAAA,OAAAA,EAAAG,EAAAD,IAAAF,EAAA,CAAA,SAAAI,wBAAAJ,EAAAE,GAAAA,IAAAA,GAAAF,GAAAA,EAAAK,WAAAL,OAAAA,EAAAA,GAAAA,OAAAA,GAAAA,iBAAAA,GAAAA,mBAAAA,EAAAM,MAAAA,CAAAA,QAAAN,GAAAG,IAAAA,EAAAJ,yBAAAG,GAAA,GAAAC,GAAAA,EAAAI,IAAAP,GAAA,OAAAG,EAAAK,IAAAR,GAAA,IAAAS,EAAA,CAAAC,UAAA,MAAAC,EAAAC,OAAAC,gBAAAD,OAAAE,yBAAA,IAAA,IAAAC,KAAAf,EAAAe,GAAAA,YAAAA,GAAAC,CAAAA,EAAAA,eAAAC,KAAAjB,EAAAe,GAAAG,CAAAA,IAAAA,EAAAP,EAAAC,OAAAE,yBAAAd,EAAAe,GAAAG,KAAAA,IAAAA,EAAAV,KAAAU,EAAAC,KAAAP,OAAAC,eAAAJ,EAAAM,EAAAG,GAAAT,EAAAM,GAAAf,EAAAe,GAAAN,OAAAA,EAAAH,QAAAN,EAAAG,GAAAA,EAAAgB,IAAAnB,EAAAS,GAAAA;;;;;;;KAAA,8EADhCW,UAAAhB,wBAAAgB,WACAC,IAAAjB,wBAAAiB,KAoDEC,SAAAC,KA5CkBC,iBAChB,MAAMC,OAASC,SAASD,OAClBE,OAASD,SAASC,OAClBC,aAAeP,IAAIQ,WAAW,UAAW,kBACzCC,iBAAmBT,IAAIQ,WAAW,cAAe,kBACvD,IAAIE,aAAe,EACfC,iBAAmB,EAEvB,IAAK,MAAMC,OAAOR,OAAQ,CACtB,MAAMS,MAAQC,SAASC,eAAe,yBAA2BX,OAAOQ,MACxE,IAAKC,MACD,OAEJ,MAAMG,MAAQH,MAAMI,KAAK,GAAGC,MAC5B,IAAK,IAAIrB,EAAI,EAAGA,EAAImB,MAAMG,OAAQtB,IAC1BmB,MAAMnB,GAAGuB,UAAUC,SAASd,OAAS,kCACrCG,YAAcb,GAElByB,OAAOC,QAAQC,IAAIR,MAAMnB,GAAGuB,WACxBJ,MAAMnB,GAAGuB,UAAUC,SAASZ,cAC5BE,gBAAkBd,GAI1B,GADAyB,OAAOC,QAAQC,IAAIb,gBAAiBD,cACf,IAAjBA,cAA2C,IAArBC,gBACtB,OAEJ,IAAK,IAAId,EAAI,EAAGA,EAAIgB,MAAMY,QAAQ,GAAGR,KAAKE,OAAQtB,IAAK,CACnD,MAAM6B,KAAOZ,SAASC,eAAe,yBAA2BX,OAAOQ,KACjE,KAAOf,EAAI,KAAOa,YAAYiB,YAC9BlB,WAAaK,SAASC,eAAe,yBAA2BX,OAAOQ,KACvE,KAAOf,EAAI,KAAOc,gBAAgBgB,YAClCC,QAAUF,KAAKN,UACrB,IAAK,MAAMR,OAAON,OAAQ,CACtB,GAAIsB,QAAQP,SAASf,OAAOM,KAAKiB,UAAYnB,aAAe,EAAG,CAC3D,MAAMoB,KAACA,YAAe/B,UAAUgC,iBAAiB,uBAAwB,CAAE,GAC3EL,KAAKN,UAAYU,IACrB,CACIF,QAAQP,SAASf,OAAOM,KAAKiB,UAAYlB,iBAAmB,IAC5DF,WAAWW,UAAY,IAE/B,CACJ,CACJ,EACF"}